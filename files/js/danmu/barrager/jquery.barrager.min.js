/*!
 *@name     jquery.barrager.js
 *@version  1.1
 *@author   yaseng@uauc.net
 *@url      https://github.com/yaseng/jquery.barrager.js
 */
(function($){
//加载css
$("<link>").attr({ rel: "stylesheet",type: "text/css",href: "/files/js/danmu/barrager/barrager.css"}).appendTo("head");
$.fn.barrager=function(barrage){barrage=$.extend({position:0,close:true,bottom:0,max:10,speed:8,color:'#fff',old_ie_color:'#000000',size:12,opacity:1},barrage||{});var time=new Date().getTime();var barrager_id='barrage_'+time;var id='#'+barrager_id;var div_barrager=$("<div class='barrage' id='"+barrager_id+"' style='opacity:"+barrage.opacity+"'></div>").appendTo($(this));var window_height=$(window).height()-100;var this_height=barrage.bodyHeight?barrage.bodyHeight:(window_height>this.height())?this.height():window_height;var window_width=$(window).width()+500;var this_width=(window_width>this.width())?this.width():window_width;var areaAvgHeight=barrage.position>0?this_height/3:this_height;var position=Math.floor(Math.random()*this_height);var offset=0;if(barrage.position>0){if(barrage.position==1){offset=areaAvgHeight*2-50}else{if(barrage.position==2){offset=areaAvgHeight}}position=Math.floor(Math.random()*areaAvgHeight)+offset};var bottom=(barrage.bottom==0)?position:barrage.bottom;div_barrager.css("bottom",bottom+"px");div_barrager_box=$("<div class='barrage_box cl'></div>").appendTo(div_barrager);if(barrage.img){div_barrager_box.append("<a class='portrait z' href='javascript:;'></a>");var img=$("<img src='' >").appendTo(id+" .barrage_box .portrait");img.attr('src',barrage.img)}div_barrager_box.append(" <div class='z p'></div>");if(barrage.close){div_barrager_box.append(" <div class='close z'></div>")}var content=$("<a title='' href='javascript:;'></a>").appendTo(id+" .barrage_box .p");if(barrage.href){content.attr('target','_blank')};content.css({'font-size':barrage.size});content.attr({'href':barrage.href,'id':barrage.id,'title':barrage.info}).empty().append(barrage.info);if(navigator.userAgent.indexOf("MSIE 6.0")>0||navigator.userAgent.indexOf("MSIE 7.0")>0||navigator.userAgent.indexOf("MSIE 8.0")>0){content.css('color',barrage.old_ie_color)}else{content.css('color',barrage.color)}var i=0;div_barrager.css('margin-right',0);$(id).animate({right:this_width},barrage.speed*1000,function(){$(id).remove()});div_barrager_box.mouseover(function(){$(id).stop(true)});div_barrager_box.mouseout(function(){$(id).animate({right:this_width},barrage.speed*1000,function(){$(id).remove()})});$(id+'.barrage .barrage_box .close').click(function(){$(id).remove()})};$.fn.barrager.removeAll=function(){$('.barrage').remove()}})(jQuery);
